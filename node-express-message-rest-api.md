# Node Express Message REST API

Rasmus Cederdorff (RACE)  
Senior Lecturer & Web App Developer  
race@eaaa.dk

---

## Oversigt over opgaver

**Du kommer til at gennemg√• f√∏lgende opgaver i r√¶kkef√∏lge:**
- **Foruds√¶tninger** ‚Üí Sikr at Node.js og VS Code er installeret
- **Opret projektet** ‚Üí Ny mappe og √•bn i VS Code
- **Initialiser Node.js-projektet** ‚Üí `npm init` og `package.json`
- **Konfigurer package.json og scripts** ‚Üí ES modules og npm scripts
- **Opret data-mappe og besked-fil** ‚Üí JSON fil med eksempel-data
- **Opret og start din server** ‚Üí Express installation og server.js
- **L√¶s og skriv data fra fil** ‚Üí Helper funktioner og test-routes
- **Opret REST routes** ‚Üí CRUD endpoints (GET, POST, PUT, DELETE)
- **Test dit API komplet** ‚Üí Systematisk test af alle endpoints
- **Refleksion og n√¶ste skridt** ‚Üí Forbedringer og videre udvikling
- **üöÄ EKSTRAOPGAVE: Professionel API-udvikling** ‚Üí Statuskoder, fejlh√•ndtering og avancerede features

---

## 0. Foruds√¶tninger

Sikr at du har Node.js og VS Code installeret:

- **Node.js** - √Öbn terminal og skriv `node --version` (skal vise 20.x eller nyere).
- **VS Code** og n√∏dvendige extensions - √Öbn VS Code og tjek at det starter.

<details>
<summary>Hint - Hvor downloader jeg Node.js?</summary>

G√• til https://nodejs.org og download den LTS-version (anbefalet version).
Efter installation, genstart din computer hvis n√∏dvendigt.

</details>

---

## 1. Opret projektet

1. Opret en ny mappe der hvor du plejer at placere dine projekter.
2. Giv mappen et sigende navn, fx `node-express-message-rest-api`
3. H√∏jreklik p√• mappen og v√¶lg "Open with Code" (eller √•bn VS Code og tr√¶k mappen ind). Du kan ogs√• bruge terminalen og kommandoen `code .` til at √•bne projektmappen i VS Code
4. Du skal nu se din tomme mappe i VS Code's file explorer

<details>
<summary>Hint - Jeg kan ikke se "Open with Code"</summary>

√Öbn VS Code f√∏rst, g√• til File ‚Üí Open Folder og v√¶lg din projektmappe.

</details>

---

## 2. Initialiser Node.js-projektet

1. √Öbn terminalen i VS Code (Terminal ‚Üí New Terminal). Hvis du er p√• en PC, s√• s√∏rg for at anvende Command Prompt.
2. Skriv `npm init` og tryk Enter
3. Besvar sp√∏rgsm√•lene:
   - **entry point**: Skriv `server.js` (VIGTIGT!)
   - Resten kan du bare trykke Enter p√•
4. Skriv `yes` n√•r du f√•r vist oversigten

Du f√•r nu en `package.json` fil med projektinformation.

<details>
<summary>Hint - Jeg f√•r fejl i terminalen</summary>

S√∏rg for at terminalen er √•bnet i din projektmappe. Du skal se mappenavnet i terminalen.
Hvis ikke, naviger til mappen med `cd sti-til-din-mappe`

</details>

<details>
<summary>Hint - Hurtig version</summary>

Du kan ogs√• bare skrive `npm init -y` for at acceptere alle standardv√¶rdier.
Husk bagefter at √¶ndre "main" til "server.js" i package.json.

</details>

**‚úÖ package.json oprettet?** ‚Üí Forts√¶t til **Opgave 3**

---

## 3. Konfigurer package.json og scripts

Ops√¶t ES modules og npm scripts til udvikling:

1. √Öbn `package.json` i VS Code
2. Find linjen med `"main": "server.js",`
3. Tilf√∏j en ny linje efter denne: `"type": "module",` - hvis der allerede er defineret en `"type"` skal du s√∏rge for at √¶ndre den til `"module"`.
4. Find sektionen `"scripts"` og erstat med:

   ```json
   "scripts": {
     "start": "node server.js",
     "dev": "node --watch server.js"
   },
   ```

5. Gem filen (Ctrl+S eller Cmd+S)

**Hvad g√∏r dette?**

- ES modules: Moderne import/export syntax (`import` i stedet for `require`)
- `npm start`: Starter serveren √©n gang
- `npm run dev`: Starter serveren og genstarter automatisk ved √¶ndringer

<details>
<summary>Hint - JSON format fejl</summary>

Hvis VS Code viser r√∏de streger, tjek:

- Er der komma efter hver linje (undtagen den sidste)?
- Er alle strenge omgivet af anf√∏rselstegn?
- Er der matchende kr√∏llede parenteser?
</details>

<details>
<summary>Hint - Jeg er ikke sikker p√• syntaksen</summary>

Du kan bruge JSON-validatorer online til at tjekke om din JSON er korrekt.
Eller se VS Code's error-meddelelser i Problems-panelet.

</details>

**‚úÖ ES modules konfigureret?** ‚Üí Forts√¶t til **Opgave 4**

---

## 4. Opret data-mappe og besked-fil

1. H√∏jreklik i VS Code's file explorer ‚Üí "New Folder" ‚Üí kald den `data`
2. H√∏jreklik p√• `data` mappen ‚Üí "New File" ‚Üí kald den `messages.json`
3. √Öbn `messages.json` og inds√¶t dette eksempel-data (du m√• selvf√∏lgelig ogs√• gerne lave dit eget datas√¶t, men guiden forventer at du har et array med message-objekter best√•ende af `id`, `date`, `text` og `sender`):

```json
[
  {
    "id": "e1a2c3d4-1111-2222-3333-444455556666",
    "date": "2025-09-03T09:15:00.000Z",
    "text": "Hej! Hvordan g√•r det?",
    "sender": "user"
  },
  {
    "id": "f7b8a9c0-7777-8888-9999-000011112222",
    "date": "2025-09-03T09:16:00.000Z",
    "text": "Det g√•r fint, tak! Hvordan kan jeg hj√¶lpe dig?",
    "sender": "chatbot"
  },
  {
    "id": "aabbccdd-1234-5678-9101-112131415161",
    "date": "2025-09-03T09:17:00.000Z",
    "text": "Kan du vise mig dagens vejr?",
    "sender": "user"
  },
  {
    "id": "bbccddee-2233-4455-6677-889900001111",
    "date": "2025-09-03T09:17:05.000Z",
    "text": "Selvf√∏lgelig! Her er vejrudsigten for i dag...",
    "sender": "chatbot"
  },
  {
    "id": "ccddeeff-3344-5566-7788-990011112222",
    "date": "2025-09-03T09:18:00.000Z",
    "text": "Tak for hj√¶lpen!",
    "sender": "user"
  },
  {
    "id": "ddeeff00-4455-6677-8899-001122334455",
    "date": "2025-09-03T09:18:10.000Z",
    "text": "Det var s√• lidt. Sp√∏rg endelig igen!",
    "sender": "chatbot"
  }
]
```

**Hvad betyder dette format?**

- `[]` = en array (liste) med objekter (`message`-objekter)
- Hver `message` er et objekt `{}` med egenskaberne `id`, `date`, `text` og `sender`.
- Objekterne er adskilt med kommaer
- Dette format g√∏r det nemt for vores API at l√¶se og skrive beskeder

**Din projektstruktur skal nu se s√•dan ud:**

```
dit-projekt-navn/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ messages.json
‚îî‚îÄ‚îÄ package.json
```

<details>
<summary>Hint - Jeg kan ikke se hvordan man laver mapper</summary>

H√∏jreklik pr√¶cis i det hvide omr√•de i VS Code's file explorer.
Hvis det ikke virker, pr√∏v at klikke p√• projektmappens navn f√∏rst.

</details>

<details>
<summary>Hint - Hvad er JSON?</summary>

JSON = JavaScript Object Notation. Det er en m√•de at gemme data som tekst.
Det ligner JavaScript objekter, men alt skal v√¶re i anf√∏rselstegn.

</details>

**‚úÖ Data-mappe og messages.json med indhold oprettet?** ‚Üí Forts√¶t til **Opgave 5**

---

## 5. Opret og start din server

### Step 1: Installer Express

1. I terminalen: `npm install express`

### Step 2: Opret server.js

1. H√∏jreklik i projektmappen ‚Üí "New File" ‚Üí `server.js`
2. Skriv denne kode:

```js
import express from "express";

const app = express();
const PORT = 3000;

app.listen(PORT, () => {
  console.log(`App listening on port ${PORT}`);
});
```

**Test at det virker:**

1. Gem filen (Ctrl+S eller Cmd+S)
2. √Öbn terminalen og skriv: `node server.js`
3. Du skal se: "App listening on port 3000"

Hvis det virker - godt! Du har nu en k√∏rende server. ‚úÖ

---

### Step 3: Tilf√∏j en simpel route

**Hvorfor g√∏r vi dette?**
Nu kan serveren k√∏re, men den svarer ikke p√• requests. Lad os tilf√∏je en grundl√¶ggende route.

**Tilf√∏j denne linje lige F√òR `app.listen`:**

```js
app.get("/", (req, res) => {
  res.send("Node.js Messages REST API üéâ");
});
```

**S√•dan ser din `server.js` ud nu:**

```js
import express from "express";

const app = express();
const PORT = 3000;

app.get("/", (req, res) => {
  res.send("Node.js Messages REST API üéâ");
});

app.listen(PORT, () => {
  console.log(`App listening on port ${PORT}`);
});
```

**Test igen:**

1. Stop serveren (Ctrl+C)
2. Start den igen: `node server.js`
3. √Öbn browser: http://localhost:3000
4. Du skal se: "Node.js Messages REST API üéâ"

Fungerer det? Perfekt! Nu svarer din server p√• requests. ‚úÖ


**Din projektstruktur skal nu se s√•dan ud:**

```
dit-projekt-navn/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ messages.json
‚îú‚îÄ‚îÄ node_modules/
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ package.json
```

---

### üí° Pro tip: Skift til `npm run dev` nu!

**Irriteret over at stoppe og starte serveren hele tiden?** üòÖ

Husk de scripts vi lavede i opgave 3? Nu kan du bruge dem!

**I stedet for `node server.js`, pr√∏v:**

```bash
npm run dev
```

**Hvad sker der?**

- Serveren starter med `--watch` flag
- Den overv√•ger alle `.js` filer
- Genstarter automatisk n√•r du gemmer √¶ndringer
- Du sparer tid! ‚ö°

**Test det lige nu:**

1. Stop din server (Ctrl+C)
2. Start med: `npm run dev`
3. √Ündr teksten til: `"Node.js Messages REST API üöÄ UPDATED!"`
4. Gem filen - se serveren genstartes automatisk!
5. Genindl√¶s browseren - √¶ndringen er der allerede!

**Fra nu af bruger vi altid `npm run dev` under udvikling! üéØ**

---

### Step 4: Tilf√∏j JSON support

**Hvorfor skal vi have dette?**
Vores API skal kunne modtage og sende JSON data (som vores beskeder). Express forst√•r ikke JSON automatisk.

**Tilf√∏j denne linje lige EFTER `const PORT = 3000;`:**

```js
app.use(express.json());
```

**Hvad g√∏r `express.json()`?**

- Fort√¶ller Express at den skal kunne l√¶se JSON fra requests
- Konverterer automatisk JSON til JavaScript objekter
- G√∏r det muligt at bruge `req.body` i vores routes

**Din server.js ser nu s√•dan ud:**

```js
import express from "express";

const app = express();
const PORT = 3000;
app.use(express.json());

app.get("/", (req, res) => {
  res.send("Node.js Messages REST API üéâ");
});

app.listen(PORT, () => {
  console.log(`App listening on port ${PORT}`);
});
```

**Test igen:**

1. Stop og genstart serveren (eller beh√∏ver du det?)
2. Tjek at http://localhost:3000 stadig virker

---

### Step 5: Installer og tilf√∏j CORS support

**F√∏rst skal vi installere CORS:**

1. Stop serveren (Ctrl+C)
2. Skriv `npm install cors` og tryk Enter
3. Vent p√• installationen er f√¶rdig

**Hvad er CORS og hvorfor skal vi bruge det?**

- CORS = Cross-Origin Resource Sharing
- Browsere blokerer som standard requests mellem forskellige dom√¶ner
- Vi skal tillade andre websites/apps at bruge vores API

**Tilf√∏j CORS import √∏verst:**

```js
import cors from "cors";
```

**Tilf√∏j CORS middleware efter `express.json()`:**

```js
app.use(cors());
```

**Din komplette server.js ser nu s√•dan ud:**

```js
import express from "express";
import cors from "cors";

const app = express();
const PORT = 3000;
app.use(express.json());
app.use(cors());

app.get("/", (req, res) => {
  res.send("Node.js Messages REST API üéâ");
});

app.listen(PORT, () => {
  console.log(`App listening on port ${PORT}`);
});
```

**Final test:**

1. Stop og genstart serveren
2. Tjek at http://localhost:3000 stadig virker
3. Du har nu en fungerende Express-server med JSON og CORS support! üéâ

**Stop serveren:**
Tryk Ctrl+C i terminalen n√•r du er f√¶rdig.

**‚úÖ Server k√∏rer p√• localhost:3000?** ‚Üí Forts√¶t til **Opgave 6**

---

## 6. L√¶s og skriv data fra fil

### 6.1: Tilf√∏j imports

Vi skal kunne arbejde med filer og generere IDs. Hvilke imports skal vi tilf√∏je √∏verst i `server.js`?

<details>
<summary>üí° Hint - Hvilke imports?</summary>

```js
import fs from "fs/promises";
import { randomUUID } from "crypto";
```

**Hvad g√∏r disse imports?**

- `fs/promises` - Lader os l√¶se og skrive filer asynkront
- `randomUUID` - Genererer unikke IDs til nye beskeder

</details>

### 6.2: Test fil-l√¶sning

Lav en test-route der kan l√¶se din `messages.json` fil:

1. **Opgave:** Lav en GET route til `/test-read`
2. **Den skal:** L√¶se filen `data/messages.json` som tekst
3. **Den skal:** Konvertere teksten til JavaScript objekter
4. **Den skal:** Sende objekterne som JSON tilbage

**Pr√∏v selv f√∏rst!** Hvad tror du koden skal v√¶re?

<details>
<summary>üí° Hint - test-read route</summary>

```js
app.get("/test-read", async (req, res) => {
  const data = await fs.readFile("data/messages.json", "utf8");
  const messages = JSON.parse(data);
  res.json(messages);
});
```

**Hvad sker der her?**

- `fs.readFile()` l√¶ser filen som tekst
- `JSON.parse()` konverterer tekst til JavaScript objekter
- `res.json()` sender objekterne tilbage som JSON

</details>

**Test nu:** http://localhost:3000/test-read

- Ser du alle dine beskeder?

### 6.3: Test fil-skrivning

Lav en test-route der kan tilf√∏je en ny besked:

1. **Opgave:** Lav en GET route til `/test-write`
2. **Den skal:** L√¶se eksisterende beskeder
3. **Den skal:** Lave et nyt besked-objekt med ID, dato, tekst og sender
4. **Den skal:** Tilf√∏je den nye besked til listen
5. **Den skal:** Skrive den opdaterede liste tilbage til filen

**Pr√∏v at bygge det step for step!**

**Hint 1:** Hvordan laver du et unikt ID? `randomUUID()`
**Hint 2:** Hvordan laver du en dato? `new Date().toISOString()`
**Hint 3:** Hvordan tilf√∏jer du til en array? `.push()`

<details>
<summary>üí° Hint - test-write route</summary>

```js
app.get("/test-write", async (req, res) => {
  // L√¶s eksisterende beskeder
  const data = await fs.readFile("data/messages.json", "utf8");
  const messages = JSON.parse(data);

  // Lav ny besked
  const newMessage = {
    id: randomUUID(),
    date: new Date().toISOString(),
    text: "Test besked fra serveren!",
    sender: "server"
  };

  // Tilf√∏j til listen
  messages.push(newMessage);

  // Skriv tilbage til fil
  await fs.writeFile("data/messages.json", JSON.stringify(messages, null, 2));

  res.json(newMessage);
});
```

**Hvad sker der her?**

- Vi l√¶ser alle beskeder f√∏rst
- Laver et nyt besked-objekt med auto-genereret ID og tidsstempel
- Tilf√∏jer det til listen med `.push()`
- Skriver hele listen tilbage til filen

</details>

**Test nu:** http://localhost:3000/test-write

- Tjek din `messages.json` fil - er der en ny besked?
- Test `/test-read` igen - ser du den nye besked?

### 6.4: Lav helper-funktioner

Kan du se at vi gentager kode? Lav to hj√¶lpefunktioner:

1. **readMessages()** - skal l√¶se og parse JSON
2. **writeMessages(messages)** - skal skrive array til fil

**Pr√∏v selv f√∏rst!**

<details>
<summary>üí° Hint - Helper funktioner</summary>

```js
// Tilf√∏j disse funktioner efter imports
async function readMessages() {
  const data = await fs.readFile("data/messages.json", "utf8");
  return JSON.parse(data);
}

async function writeMessages(messages) {
  await fs.writeFile("data/messages.json", JSON.stringify(messages, null, 2));
}
```

**Fordele ved helper funktioner:**

- Mindre gentagelse af kode
- Nemmere at vedligeholde
- Bedre l√¶sbarhed

</details>

### 6.5: Brug helper-funktioner i fil-l√¶sning

**Opgave:** Nu skal du refactore din `/test-read` route til at bruge helper-funktionen.

**T√¶nk over det:**

- Du har nu en `readMessages()` funktion
- Den g√∏r pr√¶cis det samme som de f√∏rste to linjer i din test-read route
- Kan du erstatte de to linjer med √©t enkelt kald?

**Pr√∏v selv f√∏rst!** Din route skal blive meget kortere.

<details>
<summary>üí° L√∏sning - Refactored test-read</summary>

```js
app.get("/test-read", async (req, res) => {
  const messages = await readMessages();
  res.json(messages);
});
```

**Sammenlign:** Fra 3 linjer kode til 2 linjer - meget mere l√¶sbart!

</details>

**Test igen:** http://localhost:3000/test-read

- Virker det stadig?

### 6.6: Brug helper-funktioner i fil-skrivning

**Opgave:** Nu skal du refactore din `/test-write` route til at bruge begge helper-funktioner.

**T√¶nk over det:**

- Du kan bruge `readMessages()` i stedet for de f√∏rste to linjer
- Du kan bruge `writeMessages(messages)` i stedet for `fs.writeFile()`
- Hvilke linjer skal du √¶ndre?

**Pr√∏v selv f√∏rst!** Find de steder hvor du kan bruge helper-funktionerne.

<details>
<summary>üí° L√∏sning - Refactored test-write</summary>

```js
app.get("/test-write", async (req, res) => {
  // L√¶s eksisterende beskeder
  const messages = await readMessages();

  // Lav ny besked
  const newMessage = {
    id: randomUUID(),
    date: new Date().toISOString(),
    text: "Test besked fra serveren!",
    sender: "server"
  };

  // Tilf√∏j til listen
  messages.push(newMessage);

  // Skriv tilbage til fil
  await writeMessages(messages);

  res.json(newMessage);
});
```

**Fordele:**

- Kortere og mere l√¶sbar kode
- Nemmere at vedligeholde
- Hvis filstien √¶ndres, skal du kun rette √©t sted

</details>

**Test igen:** http://localhost:3000/test-write

- Virker det stadig?

**‚úÖ Kan l√¶se og skrive til messages.json med helper-funktioner?** ‚Üí Forts√¶t til **Opgave 7**

---

## 7. Opret REST routes

Nu skal vi lave de rigtige API endpoints! Fjern test-routes og lav CRUD operations.

### 7.1 GET alle beskeder

**Opgave:** Lav en route der returnerer alle beskeder n√•r man bes√∏ger `/messages`

**Hvad skal den g√∏re?**

1. Bruge GET method
2. L√¶se alle beskeder med helper-funktionen
3. Returnere dem som JSON

**Pr√∏v selv f√∏rst!**

<details>
<summary>üí° Hint - GET alle beskeder</summary>

```js
app.get("/messages", async (req, res) => {
  const messages = await readMessages();
  res.json(messages);
});
```

</details>

**Test:** http://localhost:3000/messages

### 7.2 GET √©n besked

**Opgave:** Lav en route der returnerer √©n specifik besked baseret p√• ID

**Hvad skal den g√∏re?**

1. Bruge GET method med parameter: `/messages/:id`
2. L√¶se alle beskeder
3. Finde den besked der matcher ID'et (brug `.find()`)
4. Returnere kun den besked

**Tips:** `req.params.id` giver dig ID fra URL'en

<details>
<summary>üí° Hint - GET √©n besked</summary>

```js
app.get("/messages/:id", async (req, res) => {
  const messages = await readMessages();
  const messageId = req.params.id;
  const message = messages.find(m => m.id === messageId);
  res.json(message);
});
```

</details>

**Test:** Kopier et ID fra alle beskeder og bes√∏g http://localhost:3000/messages/[id]

### 7.3 POST ny besked

**Opgave:** Lav en route der kan oprette nye beskeder

**Hvad skal den g√∏re?**

1. Bruge POST method til `/messages`
2. L√¶se eksisterende beskeder
3. Hente `text` og `sender` fra request body (`req.body`)
4. Lave et nyt besked-objekt med auto-genereret ID og dato
5. Tilf√∏je den nye besked til listen
6. Gemme listen og returnere den nye besked

**Pr√∏v selv f√∏rst!** T√¶nk p√• hvad du har l√¶rt fra test-write route.

<details>
<summary>üí° Hint - POST ny besked</summary>

```js
app.post("/messages", async (req, res) => {
  const messages = await readMessages();
  const { text, sender } = req.body;

  const newMessage = {
    id: randomUUID(),
    date: new Date().toISOString(),
    text,
    sender
  };

  messages.push(newMessage);
  await writeMessages(messages);
  res.json(newMessage);
});
```

</details>

**Test med Thunder Client:**

- Method: POST
- URL: http://localhost:3000/messages
- Body: `{ "text": "Min f√∏rste API besked!", "sender": "user" }`

### 7.4 PUT opdater besked

**Opgave:** Lav en route der kan opdatere en eksisterende besked

**Hvad skal den g√∏re?**

1. Bruge PUT method til `/messages/:id`
2. L√¶se alle beskeder
3. Finde den rigtige besked med `find()` (ikke findIndex!)
4. Opdatere besked-objektets egenskaber direkte
5. Gemme og returnere den opdaterede besked

**T√¶nk over det:**

- Skal du finde besked-positionen eller selve besked-objektet?
- Kan du √¶ndre egenskaber direkte p√• objektet?

**Tips:**

- `find()` returnerer selve objektet
- Du kan s√¶tte `message.text = newText` direkte
- Objekter i JavaScript er references - √¶ndringer p√•virker originalen

<details>
<summary>üí° Hint - PUT opdater besked</summary>

```js
app.put("/messages/:id", async (req, res) => {
  const messages = await readMessages();
  const messageId = req.params.id;
  const message = messages.find(message => message.id === messageId);

  const { text, sender } = req.body;
  message.text = text;
  message.sender = sender;

  writeMessages(messages);
  res.json(message);
});
```

</details>

**Test med Thunder Client:**

- Method: PUT
- URL: http://localhost:3000/messages/[id]
- Body: `{ "text": "Opdateret!", "sender": "updated-user" }`

### 7.5 DELETE slet besked

**Opgave:** Lav en route der kan slette en besked

**Hvad skal den g√∏re?**

1. Bruge DELETE method til `/messages/:id`
2. L√¶se alle beskeder
3. Finde og gemme beskeden der skal slettes
4. Fjerne beskeden fra array
5. Gemme opdateret liste
6. Returnere bekr√¶ftelse + den slettede besked

**To m√•der at fjerne elementer:**

- **Metode 1:** `findIndex()` + `splice()` - finder position og fjerner
- **Metode 2:** `find()` + `filter()` - finder element og laver ny array

<details>
<summary>üí° Hint - DELETE med findIndex + splice</summary>

```js
app.delete("/messages/:id", async (req, res) => {
  const messages = await readMessages();
  const messageId = req.params.id;

  const messageIndex = messages.findIndex(m => m.id === messageId);
  const deletedMessage = messages[messageIndex];

  messages.splice(messageIndex, 1);
  await writeMessages(messages);

  res.json({
    message: "Message deleted successfully",
    deletedMessage
  });
});
```

**Fordele:** Modificerer eksisterende array direkte

</details>

<details>
<summary>üí° Hint - DELETE med find + filter (alternativ)</summary>

```js
app.delete("/messages/:id", async (req, res) => {
  const messages = await readMessages();
  const messageId = req.params.id;

  const deletedMessage = messages.find(m => m.id === messageId);
  const updatedMessages = messages.filter(m => m.id !== messageId);

  await writeMessages(updatedMessages);

  res.json({
    message: "Message deleted successfully",
    deletedMessage
  });
});
```

**Fordele:** Mere funktionel tilgang, nemmere at forst√•

</details>

**Test med Thunder Client:**

- Method: DELETE
- URL: http://localhost:3000/messages/[id]

**‚úÖ Alle CRUD routes implementeret?** ‚Üí Forts√¶t til **Opgave 8**

---

## 8. Test dit API komplet

**Systematisk test af alle endpoints:**

**Step 1: Test READ-operationer (GET)**

1. **Hent alle beskeder:**

   - GET http://localhost:3000/messages
   - Forventet: Array med alle beskeder

2. **Hent √©n besked:**

   - Kopier et ID fra ovenst√•ende
   - GET http://localhost:3000/messages/[id]
   - Forventet: Kun den ene besked

3. (Valgfrit) Pr√∏v et forkert ID og se hvad du f√•r tilbage.

**Step 2: Test CREATE-operation (POST)**

1. **Opret ny besked:**

   - POST http://localhost:3000/messages
   - Body: `{"text": "Test besked", "sender": "tester"}`
   - Forventet: Status 201 + ny besked med auto-genereret ID

2. Pr√∏v at sende kun `{ "text": "Test" }` og se hvad der sker. Send derefter en komplet besked.

**Step 3: Test UPDATE-operation (PUT)**

1. **Opdater eksisterende besked:**

   - PUT http://localhost:3000/messages/[eksisterende-id]
   - Body: `{"text": "Opdateret!", "sender": "opdateret"}`
   - Forventet: Opdateret besked

2. (Valgfrit) Pr√∏v et forkert ID eller uden text og se hvad der sker.

**Step 4: Test DELETE-operation (DELETE)**

1. **Slet besked:**

   - DELETE http://localhost:3000/messages/[id]
   - Forventet: Bekr√¶ftelse + slettet besked

2. **Verificer sletning:**
   - GET http://localhost:3000/messages
   - Beskeden skal v√¶re v√¶k

**Hurtig test med curl (valgfrit):**

Hvis du vil teste fra terminal:

```bash
# Hent alle beskeder
curl http://localhost:3000/messages

# Opret ny besked
curl -X POST http://localhost:3000/messages \
  -H "Content-Type: application/json" \
  -d '{"text": "Curl test", "sender": "terminal"}'
```

**‚úÖ Alle tests gennemf√∏rt?** ‚Üí Forts√¶t til **Opgave 9**

---

## 9. Refleksion og n√¶ste skridt

**Opgave:**
Overvej hvordan du kan forbedre og udvide dit API.

- Kan du genbruge kode med funktioner?
- Kan du tilf√∏je sortering eller filtrering?
- Hvordan kan du udvide med fejlh√•ndtering?

---

## 10. üöÄ EKSTRAOPGAVE: Professionel API-udvikling

**‚ö†Ô∏è Dette er en frivillig ekstraopgave for dem der vil l√¶re mere!**

Nu har du et fungerende API, men hvordan g√∏r man det mere professionelt? Her er nogle vigtige forbedringer at overveje:

### 10.1: HTTP Statuskoder

**Problem:** Dit API returnerer altid status 200, selvom der sker fejl.

**Opgave:** Tilf√∏j korrekte statuskoder til dine routes:

- **200 OK** - Succesfuld GET/PUT
- **201 Created** - Succesfuld POST
- **404 Not Found** - Besked findes ikke
- **400 Bad Request** - Ugyldig data

<details>
<summary>üí° Hint - Statuskoder i Express</summary>

```js
// 201 Created for POST
res.status(201).json(newMessage);

// 404 Not Found
if (!message) {
  return res.status(404).json({ error: "Message not found" });
}

// 400 Bad Request
if (!text || !sender) {
  return res.status(400).json({ error: "Text and sender are required" });
}
```

</details>

### 10.2: Fejlh√•ndtering

**Problem:** Hvis filen ikke findes eller er korrupt, crasher dit API.

**Opgave:** Tilf√∏j try-catch til dine helper-funktioner:

<details>
<summary>üí° Hint - Fejlh√•ndtering</summary>

```js
async function readMessages() {
  try {
    const data = await fs.readFile("data/messages.json", "utf8");
    return JSON.parse(data);
  } catch (error) {
    console.error("Error reading messages:", error);
    return []; // Return empty array if file doesn't exist
  }
}
```

</details>

### 10.3: Input-validering

**Problem:** Brugere kan sende tom data eller forkerte datatyper.

**Opgave:** Valider input i POST og PUT routes:

- Tjek at `text` og `sender` er til stede
- Tjek at `text` ikke er tom
- Tjek at ID findes ved UPDATE/DELETE

### 10.4: Andre forbedringer

**Overvej disse forbedringer:**

1. **Pagination** - Hvad hvis du har 10.000 beskeder?
2. **S√∏gning** - `/messages?search=hej`
3. **Sortering** - `/messages?sort=date`
4. **Logging** - Log alle requests for debugging
5. **Rate limiting** - Begr√¶ns antal requests per bruger
6. **CORS konfiguration** - Kun bestemte dom√¶ner
7. **Environment variables** - PORT og filstier i .env fil

<details>
<summary>üí° Eksempel - S√∏gning og sortering</summary>

```js
app.get("/messages", async (req, res) => {
  let messages = await readMessages();

  // S√∏gning
  if (req.query.search) {
    messages = messages.filter(m => m.text.toLowerCase().includes(req.query.search.toLowerCase()));
  }

  // Sortering
  if (req.query.sort === "date") {
    messages.sort((a, b) => new Date(b.date) - new Date(a.date));
  }

  res.json(messages);
});
```

</details>

### 10.5: Test dit forbedrede API

**Opgave:** Pr√∏v at bryde dit API og se hvordan det h√•ndterer fejl:

1. Slet `messages.json` filen og pr√∏v GET
2. Send POST uden `text` felt
3. Pr√∏v PUT med forkert ID
4. Send ugyldig JSON data

**‚úÖ Kan dit API h√•ndtere fejl elegant?**

---

## REST API ‚Äì Teoretisk opsummering

**Opgave:**
Forklar med egne ord:

- Hvad er et REST API?
- Hvad er forskellen p√• GET, POST, PUT og DELETE?
- Hvorfor bruger vi JSON?

<details>
<summary>Hint</summary>
Et REST API bruger HTTP-metoder til at manipulere ressourcer, som identificeres med URL‚Äôer. Data sendes som JSON, som er et tekstbaseret dataformat.
</details>

---

üí° Pr√∏v selv f√∏rst ‚Äì og brug hints, hvis du sidder fast!
Stil sp√∏rgsm√•l og reflekter over hvert trin.

---

Sig til hvis du vil have flere opgaver, billeder eller forklaringer til hvert trin!

```

```
